{
  "id": "heltec-sensor-node",
  "name": "Heltec Sensor Node",
  "version": "1.0.0",
  "description": "ESP32 sensor node with DHT22, reed switch, PIR, OLED display, and LoRa transmitter",
  "icon": "thermometer",
  "colour": 45,

  "board": {
    "type": "esp32",
    "variant": "heltec_lora_v3",
    "connection": "serial",
    "detection": {
      "usb_vid": "0x303A",
      "usb_pid": "0x1001"
    }
  },

  "capabilities": [
    { "id": "dht22", "name": "DHT22 Temperature/Humidity", "kind": "sensor", "params": [{ "name": "pin", "type": "number", "default": 5 }] },
    { "id": "reed_switch", "name": "Reed Switch (Door)", "kind": "sensor", "params": [{ "name": "pin", "type": "number", "default": 6 }] },
    { "id": "pir", "name": "PIR Motion Sensor", "kind": "sensor", "params": [{ "name": "pin", "type": "number", "default": 7 }] },
    { "id": "oled_ssd1306", "name": "OLED Display", "kind": "display", "params": [{ "name": "sda", "type": "number", "default": 17 }, { "name": "scl", "type": "number", "default": 18 }] },
    { "id": "lora_tx", "name": "LoRa Transmit", "kind": "radio", "params": [{ "name": "channel", "type": "number", "default": 1, "min": 0, "max": 255 }] }
  ],

  "blocks": [
    {
      "type": "heltec_sensor_node",
      "message": "Sensor Node %1 DHT22 %2 Pin %3 Reed Switch %4 Pin %5 PIR %6 Pin %7 OLED %8 LoRa Channel %9 Interval (s) %10",
      "args": [
        { "type": "input_dummy" },
        { "type": "field_checkbox", "name": "SENSOR_DHT22", "checked": true },
        { "type": "field_number", "name": "PIN_DHT22", "value": 5, "min": 0, "max": 48 },
        { "type": "field_checkbox", "name": "SENSOR_REED", "checked": true },
        { "type": "field_number", "name": "PIN_REED", "value": 6, "min": 0, "max": 48 },
        { "type": "field_checkbox", "name": "SENSOR_PIR", "checked": true },
        { "type": "field_number", "name": "PIN_PIR", "value": 7, "min": 0, "max": 48 },
        { "type": "field_checkbox", "name": "HAS_OLED", "checked": true },
        { "type": "field_number", "name": "LORA_CHANNEL", "value": 1, "min": 0, "max": 255 },
        { "type": "field_number", "name": "INTERVAL", "value": 10, "min": 1, "max": 3600 }
      ],
      "previousStatement": true,
      "nextStatement": true,
      "tooltip": "Configure a Heltec sensor node with selected sensors"
    }
  ],

  "deploy": {
    "method": "flash",
    "provides": [],
    "requires": [],
    "flash": {
      "files": ["sensor_main.py"],
      "lib": ["sensors.py", "nodes.py"],
      "shared_lib": ["elisa_hardware.py", "_sx126x.py", "sx126x.py", "sx1262.py", "oled.py", "ssd1306.py"],
      "prompt_message": "Plug in your Sensor Node and click Ready"
    }
  },

  "spec_mapping": {
    "role": "sensor_node",
    "extract_fields": {
      "sensors": {
        "SENSOR_DHT22": "dht22",
        "SENSOR_REED": "reed_switch",
        "SENSOR_PIR": "pir"
      },
      "display": { "HAS_OLED": "oled_ssd1306" },
      "pins": {
        "PIN_DHT22": "dht22_pin",
        "PIN_REED": "reed_pin",
        "PIN_PIR": "pir_pin"
      },
      "lora.channel": "LORA_CHANNEL"
    }
  }
}
